<div class="filters-container">
  <h2>Find Your Teammates</h2>

  <div class="search-wrapper">
    <img src="assets/svg/Search_icon.svg" alt="Search" class="search-icon" />
    <input type="search" name="playerSearch" [formControl]="searchControl" placeholder="Search by username"
      autocomplete="off" spellcheck="false" inputmode="search" class="search-input" aria-label="Search by username" />
  </div>

  <div class="filters" role="region" aria-label="Filters">

    <!-- STATUS -->
    <div class="checkbox-collapsible">
      <!-- PÄIVITETTY: Teksti on nyt dynaaminen -->
      <button type="button" (click)="toggleDropdown('status')" [attr.aria-expanded]="openDropdown === 'status'"
        aria-haspopup="true">
        {{ selectedStatusLabel }} ▾
      </button>

      @if (openDropdown === 'status') {
      <div class="checkbox-list animate-fade" role="menu">
        <label class="checkbox-item" (click)="$event.stopPropagation()">
          <input type="radio" name="status" (change)="onStatusChange('')" [checked]="!filters.Status" />
          <span class="item-text">Any status</span>
        </label>

        <label class="checkbox-item" (click)="$event.stopPropagation()">
          <input type="radio" name="status" (change)="onStatusChange('online')"
            [checked]="filters.Status === 'online'" />
          <span class="item-text">Online</span>
        </label>

        <label class="checkbox-item" (click)="$event.stopPropagation()">
          <input type="radio" name="status" (change)="onStatusChange('offline')"
            [checked]="filters.Status === 'offline'" />
          <span class="item-text">Offline</span>
        </label>
      </div>
      }
    </div>

    <!-- KIELET -->
    <div class="checkbox-collapsible">
      <button type="button" (click)="toggleDropdown('languages')" [attr.aria-expanded]="openDropdown === 'languages'"
        aria-haspopup="true">
        Languages ▾
      </button>

      @if (openDropdown === 'languages') {
      <div class="checkbox-list animate-fade" role="menu" (click)="$event.stopPropagation()">
        @for (lang of availableLanguages; track lang.value) {
        <label class="checkbox-item">
          <input type="checkbox" [value]="lang.value" (change)="onLanguageToggle($event, lang.value)"
            [checked]="filters.languages.includes(lang.value)" />
          <span class="item-text">{{ lang.label }}</span>
        </label>
        } @empty {
        <p>No languages available</p>
        }
      </div>
      }
    </div>

    <!-- PELIT -->
    <div class="checkbox-collapsible">
      <button type="button" (click)="toggleDropdown('games')" [attr.aria-expanded]="openDropdown === 'games'"
        aria-haspopup="true">
        Games ▾
      </button>

      @if (openDropdown === 'games') {
      <div class="checkbox-list animate-fade" role="menu" (click)="$event.stopPropagation()">
        @for (game of games; track game.PK) {
        <label class="checkbox-item">
          <input type="checkbox" [value]="game.PK.replace('GAME#','')"
            (change)="onGameToggle($event, game.PK.replace('GAME#','') || '')"
            [checked]="filters.games.includes(game.PK.replace('GAME#','') || '')" />
          <span class="item-text">{{ game.Name }}</span>
          <span class="item-count">({{ game.Popularity || 0 }})</span>
        </label>
        } @empty {
        <p>No games available</p>
        }
      </div>
      }
    </div>

    <!-- PLAYSTYLE -->
    <div class="checkbox-collapsible">
      <button type="button" (click)="toggleDropdown('playstyle')" [attr.aria-expanded]="openDropdown === 'playstyle'"
        aria-haspopup="true">
        Playstyle ▾
      </button>

      @if (openDropdown === 'playstyle') {
      <div class="checkbox-list animate-fade" role="menu" (click)="$event.stopPropagation()">
        <label class="checkbox-item">
          <input type="radio" name="playstyle" value="" (change)="onPlaystyleChange($event)"
            [checked]="!filters.playstyle" />
          <span class="item-text">Any</span>
        </label>

        @for (style of availablePlaystyles; track style) {
        <label class="checkbox-item">
          <input type="radio" name="playstyle" [value]="style" (change)="onPlaystyleChange($event)"
            [checked]="filters.playstyle === style" />
          <span class="item-text">{{ style }}</span>
        </label>
        } @empty {
        <p>No playstyles available</p>
        }
      </div>
      }
    </div>

    <!-- PLATFORMS -->
    <div class="checkbox-collapsible">
      <button type="button" (click)="toggleDropdown('platform')" [attr.aria-expanded]="openDropdown === 'platform'"
        aria-haspopup="true">
        Platforms ▾
      </button>

      @if (openDropdown === 'platform') {
      <div class="checkbox-list animate-fade" role="menu" (click)="$event.stopPropagation()">
        @for (platform of availablePlatforms; track platform) {
        <label class="checkbox-item">
          <input type="checkbox" [value]="platform" (change)="onPlatformToggle($event, platform)"
            [checked]="filters.platform.includes(platform)" />
          <span class="item-text">{{ platform }}</span>
        </label>
        } @empty {
        <p>No platforms available</p>
        }
      </div>
      }
    </div>

  </div>
</div>
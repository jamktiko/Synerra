<nav class="navigation" [class.collapsed]="isCollapsed" [class.expanded-from-collapse]="isTemporarilyExpanded">

  <!-- YlÃ¤osa -->
  <div class="top-section">
    <div class="logo-container">
      <img class="logo logo--big" src="assets/svg/logo_big.svg" alt="Synerra Logo" />
      <img class="logo logo--small" src="assets/svg/logo_small.svg" alt="Synerra Logo Small" />

    </div>

    <button type="button" class="user-profile" (click)="onUserClick()" aria-label="User menu">
      <img class="avatar" [src]="user?.ProfilePicture ? user?.ProfilePicture : 'assets/svg/Acount.svg'"
        alt="User avatar" />
      <div class="user-info" *ngIf="!isCollapsed">
        <span class="user-name">{{ user?.Username }}</span>
        <span class="user-email">{{ user?.Email }}</span>
      </div>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Navigointilinkit -->
  <div class="nav-links">
    <ng-container *ngFor="let item of navItems; trackBy: trackByLabel">
      <ng-container *ngIf="item.children?.length; else singleNavItem">
        <div class="nav-group" [class.expanded]="isGroupExpanded(item)">
          <button type="button" class="nav-group__trigger" [class.active]="isGroupExpanded(item) || isGroupActive(item)"
            (click)="toggleGroup(item)" [attr.aria-expanded]="!isCollapsed && isGroupExpanded(item)"
            [attr.aria-label]="isCollapsed ? item.label : null">
            <span class="nav-group__icon">
              <img [src]="getIconPath(item.icon)" [alt]="item.label + ' icon'" />
            </span>
            <span class="nav-group__label" *ngIf="!isCollapsed">{{ item.label }}</span>
            <span class="nav-group__chevron" aria-hidden="true" *ngIf="!isCollapsed"></span>
          </button>

          <div class="nav-submenu" *ngIf="!isCollapsed" [class.open]="isGroupExpanded(item)"
            [style.maxHeight]="getSubmenuHeight(item)">
            <a *ngFor="let child of item.children" class="nav-subitem" [routerLink]="child.route"
              [queryParams]="child.queryParams || null" routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: child.exact ?? true }" [attr.title]="child.label">
              <span class="nav-subitem__icon" *ngIf="child.icon">
                <img [src]="getIconPath(child.icon)" alt="" aria-hidden="true" />
              </span>
              <span class="nav-subitem__label">{{ child.label }}</span>
            </a>
          </div>
        </div>
      </ng-container>

      <ng-template #singleNavItem>
        <ng-container *ngIf="isCollapsed; else expandedNavButton">
          <app-button class="nav-btn" variant="sidebar" size="small" [fullWidth]="true" [icon]="item.icon"
            [routerLink]="item.route" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
            #rla="routerLinkActive" [buttonState]="rla.isActive ? 'active' : undefined" align="center">
          </app-button>
        </ng-container>
        <ng-template #expandedNavButton>
          <app-button class="nav-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="item.label"
            [icon]="item.icon" [routerLink]="item.route" routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: true}" #rla="routerLinkActive"
            [buttonState]="rla.isActive ? 'active' : undefined">
          </app-button>
        </ng-template>
      </ng-template>
    </ng-container>
  </div>

  <!-- Collapse/Expand toggle painike -->
  <!-- <div class="controls">
    <button type="button" class="collapse-toggle" (click)="toggleCollapse()"
      [attr.aria-label]="isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'" [attr.aria-pressed]="isCollapsed">
      <img *ngIf="isCollapsed" src="assets/svg/expand.svg" alt="Expand sidebar" />
      <img *ngIf="!isCollapsed" src="assets/svg/expand.svg" class="rotated" alt="Collapse sidebar" />
    </button>
  </div> -->

  <!-- Alaosa -->
  <div class="bottom-section">
    <div class="divider"></div>
    <ng-container *ngIf="isCollapsed; else expandedLogout">
      <app-button class="logout-btn" variant="sidebar" size="small" [fullWidth]="true" [icon]="logout.icon"
        (click)="logOut()" align="center"></app-button>
    </ng-container>
    <ng-template #expandedLogout>
      <app-button class="logout-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="logout.label"
        [icon]="logout.icon" (click)="logOut()"></app-button>
    </ng-template>
  </div>

  <!-- Mobile bottom navbar -->
  <div class="mobile-nav">
    <div class="nav-content">
      <a *ngFor="let item of navItemsMobile" class="nav-icon" [routerLink]="item.route" routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }">
        <img [src]="'assets/svg/' + item.icon + '.svg'" alt="{{ item.label }} icon" />
      </a>
    </div>
  </div>

</nav>

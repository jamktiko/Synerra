<nav class="navigation" [class.collapsed]="isCollapsed" [class.expanded-from-collapse]="isTemporarilyExpanded">

  <!-- YlÃ¤osa -->
  <div class="top-section">
    <a class="logo-container" routerLink="/" tabindex="-1">
      <img class="logo logo--big" src="assets/svg/logo_big.svg" alt="Synerra Logo" tabindex="-1" />
      <img class="logo logo--small" src="assets/svg/logo_small.svg" alt="Synerra Logo Small" tabindex="-1" />
    </a>

    <button type="button" class="user-profile" (click)="onUserClick()" aria-label="User menu">
      <img class="avatar"
        [src]="user?.ProfilePicture ? user?.ProfilePicture : 'assets/images/profilePicPlaceHolder.jpg'"
        alt="User avatar" />
      <div class="user-info">
        <span class="user-name">{{ user?.Username }}</span>
        <span class="user-email">{{ user?.Email }}</span>
      </div>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Navigointilinkit -->
  <div class="nav-links">
    @for (item of navItems; track item.label) {
    @if (item.children?.length) {
    <div class="nav-group" [class.expanded]="isGroupExpanded(item)">
      <button type="button" class="nav-group__trigger" [class.active]="isGroupExpanded(item) || isGroupActive(item)"
        (click)="toggleGroup(item)" [attr.aria-expanded]="isGroupExpanded(item)" [attr.aria-label]="item.label + ' menu'"
        tabindex="0">
        <span class="nav-group__icon">
          <img [src]="getIconPath(item.icon)" [alt]="item.label + ' icon'" />
        </span>
        <span class="nav-group__label">{{ item.label }}</span>
        <span class="nav-group__chevron" aria-hidden="true"></span>
      </button>

      <div class="nav-submenu" [class.open]="isGroupExpanded(item)" [style.maxHeight]="getSubmenuHeight(item)"
        [attr.aria-hidden]="!isGroupExpanded(item)">

        @for (child of item.children; track child.label) {
        <a class="nav-subitem" [routerLink]="child.route" [queryParams]="child.queryParams || null"
          routerLinkActive="active" [routerLinkActiveOptions]="{ exact: child.exact ?? true }"
          [attr.aria-label]="child.label"
          [attr.tabindex]="!isGroupExpanded(item) ? '-1' : null">

          @if (child.icon) {
          <span class="nav-subitem__icon">
            <img [src]="getIconPath(child.icon)" alt="" aria-hidden="true" />
          </span>
          }

          <span class="nav-subitem__label">{{ child.label }}</span>
        </a>
        }
      </div>
    </div>
    } @else {
    <app-button class="nav-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="item.label"
      [icon]="item.icon" [routerLink]="item.route" (click)="closeExpandedGroups()"
      routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
      #rla="routerLinkActive" [buttonState]="rla.isActive ? 'active' : undefined">
    </app-button>
    }
    }

  </div>



  <!-- Alaosa -->
  <div class="bottom-section">
    <div class="divider"></div>
    <app-button class="logout-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="logout.label"
      [icon]="logout.icon" (click)="logOut(); closeExpandedGroups()">
    </app-button>
  </div>

  <!-- Mobile bottom navbar -->
  <div class="mobile-nav">
    <div class="nav-content">
      <!-- SETTINGS item with submenu toggle -->
      @for (item of navItemsMobile; track item.label) {
      @if (item.label === 'Settings') {
      <button type="button" class="nav-icon" [class.active]="isMobileSettingsOpen" (click)="toggleMobileSettings()" 
        aria-label="Open settings menu" [attr.aria-expanded]="isMobileSettingsOpen">
        <img [src]="'assets/svg/' + item.icon + '.svg'" alt="Settings icon" />
      </button>

      <!-- The submenu -->
      @if (isMobileSettingsOpen) {
      <div class="mobile-submenu-inside">
        @for (child of settingsChildren; track child.label) {
        <a class="mobile-subitem" [routerLink]="child.route" [queryParams]="child.queryParams || null"
          (click)="isMobileSettingsOpen = false" [attr.aria-label]="'Go to ' + child.label">

          @if (child.icon) {
          <img [src]="getIconPath(child.icon)" />
          }

          <span>{{ child.label }}</span>
        </a>
        }
      </div>
      }
      } @else {
      <a class="nav-icon badge-wrapper" [routerLink]="item.route" routerLinkActive="active"
        (click)="isMobileSettingsOpen = false" [routerLinkActiveOptions]="{ exact: true }">

        <img [src]="'assets/svg/' + item.icon + '.svg'" alt="{{ item.label }} icon" />

        <!-- Badge for notifications -->
        @if (item.label === 'Social' && totalCount > 0) {
        <span class="badge">
          {{ totalCount }}
        </span>
        }
      </a>
      }
      }


    </div>

  </div>

</nav>

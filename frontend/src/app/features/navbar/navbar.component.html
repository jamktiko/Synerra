<nav class="navigation" [class.collapsed]="isCollapsed" [class.expanded-from-collapse]="isTemporarilyExpanded">

  <!-- YlÃ¤osa -->
  <div class="top-section">
    <div class="logo-container">

      <img class="logo logo--big" src="assets/svg/logo_big.svg" alt="Synerra Logo" [routerLink]="['/']" />
      <img class="logo logo--small" src="assets/svg/logo_small.svg" alt="Synerra Logo Small" [routerLink]="['/']" />

    </div>

    <button type="button" class="user-profile" (click)="onUserClick()" aria-label="User menu">
      <img class="avatar"
        [src]="user?.ProfilePicture ? user?.ProfilePicture : 'assets/images/profilePicPlaceHolder.jpg'"
        alt="User avatar" />
      <div class="user-info">
        <span class="user-name">{{ user?.Username }}</span>
        <span class="user-email">{{ user?.Email }}</span>
      </div>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Navigointilinkit -->
  <div class="nav-links">
    <ng-container *ngFor="let item of navItems; trackBy: trackByLabel">
      <ng-container *ngIf="item.children?.length; else singleNavItem">
        <div class="nav-group" [class.expanded]="isGroupExpanded(item)">
          <button type="button" class="nav-group__trigger" [class.active]="isGroupExpanded(item) || isGroupActive(item)"
            (click)="toggleGroup(item)" [attr.aria-expanded]="isGroupExpanded(item)">
            <span class="nav-group__icon">
              <img [src]="getIconPath(item.icon)" [alt]="item.label + ' icon'" />
            </span>
            <span class="nav-group__label">{{ item.label }}</span>
            <span class="nav-group__chevron" aria-hidden="true"></span>
          </button>

          <div class="nav-submenu" [class.open]="isGroupExpanded(item)" [style.maxHeight]="getSubmenuHeight(item)">
            <a *ngFor="let child of item.children" class="nav-subitem" [routerLink]="child.route"
              [queryParams]="child.queryParams || null" routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: child.exact ?? true }">
              <span class="nav-subitem__icon" *ngIf="child.icon">
                <img [src]="getIconPath(child.icon)" alt="" aria-hidden="true" />
              </span>
              <span class="nav-subitem__label">{{ child.label }}</span>
            </a>
          </div>
        </div>
      </ng-container>

      <ng-template #singleNavItem>
        <app-button class="nav-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="item.label"
          [icon]="item.icon" [routerLink]="item.route" routerLinkActive="active" (click)="closeExpandedGroups()"
          [routerLinkActiveOptions]="{exact: true}" #rla="routerLinkActive"
          [buttonState]="rla.isActive ? 'active' : undefined">
        </app-button>
      </ng-template>
    </ng-container>
  </div>



  <!-- Alaosa -->
  <div class="bottom-section">
    <div class="divider"></div>
    <app-button class="logout-btn" variant="sidebar" size="small" [fullWidth]="true" [label]="logout.label"
      [icon]="logout.icon" (click)="logOut(); closeExpandedGroups()">
    </app-button>
  </div>

  <!-- Mobile bottom navbar -->
  <div class="mobile-nav">
    <div class="nav-content">
      <!-- SETTINGS item with submenu toggle -->
      <ng-container *ngFor="let item of navItemsMobile">

        <!-- If item is Settings, override behavior -->
        <ng-container *ngIf="item.label === 'Settings'; else normalMobileItem">
          <div class="nav-icon" [class.active]="isMobileSettingsOpen" (click)="toggleMobileSettings()">
            <img [src]="'assets/svg/' + item.icon + '.svg'" alt="Settings icon" />
          </div>

          <!-- The submenu -->
          <div class="mobile-submenu-inside" *ngIf="isMobileSettingsOpen">
            <a *ngFor="let child of settingsChildren" class="mobile-subitem" [routerLink]="child.route"
              [queryParams]="child.queryParams || null" (click)="isMobileSettingsOpen = false">
              <img *ngIf="child.icon" [src]="getIconPath(child.icon)" />
              <span>{{ child.label }}</span>
            </a>
          </div>
        </ng-container>

        <!-- Normal icons -->
        <ng-template #normalMobileItem>
          <a class="nav-icon badge-wrapper" [routerLink]="item.route" routerLinkActive="active"
            (click)="isMobileSettingsOpen = false" [routerLinkActiveOptions]="{ exact: true }">

            <img [src]="'assets/svg/' + item.icon + '.svg'" alt="{{ item.label }} icon" />

            <!-- Badge for notifications -->

            <span class="badge" *ngIf="item.label === 'Social' && totalCount > 0">
              {{ totalCount }}
            </span>

          </a>
        </ng-template>

      </ng-container>

    </div>

  </div>

</nav>
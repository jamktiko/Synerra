<section class="profile-settings-page">
  <div class="main-content">
    <article class="profile-panel">
      <header class="card-header">
        <p class="breadcrumbs">Settings &gt; Profile</p>
        <h1>Profile &amp; presence</h1>
        <p class="lede">
          Refresh how other Synerra players see you. Keep your avatar, story and preferred squad info aligned.
        </p>
      </header>

      <div class="profile-grid">
        <section class="media-card">
          <div class="media-header">
            <div>
              <h2>Avatar</h2>
              <p>Upload a fresh portrait so teammates can spot you at a glance.</p>
            </div>
            @if (selectedFileName) {
            <span class="file-name">{{ selectedFileName }}</span>
            }
          </div>

          <div class="avatar-stack">
            <div class="avatar-preview" [class.placeholder]="!previewUrl">
              @if (previewUrl) {
              <img [src]="previewUrl" alt="Profile preview" />
              } @else {
              <ng-template #avatarPlaceholder>
                <img src="/assets/svg/user-avatar-placeholder.svg" alt="Default avatar" />
              </ng-template>
              }

            </div>

            <div class="upload-controls">
              <label class="upload-label">
                <input type="file" class="visually-hidden" (change)="onFileSelected($event)" />
                <span>Select file</span>
              </label>
              <app-button label="Upload" size="small" variant="highlight" (click)="upload()"
                [state]="!selectedFile ? 'disabled' : undefined">
              </app-button>
            </div>

            <p class="progress" *ngIf="uploadProgress">Uploading {{ uploadProgress }}%</p>
            <p class="success" *ngIf="uploadedUrl">
              Uploaded! <a [href]="uploadedUrl" target="_blank">View image</a>
            </p>
          </div>
        </section>

        <section class="identity-card">
          <div class="field">
            <label for="username">Display name</label>
            <div class="input-wrapper" [class.invalid]="!validUsername || usernameTaken">
              <input id="username" type="text" [(ngModel)]="username" (input)="onUsernameInput()"
                placeholder="Synerra Legend" />
            </div>
            <small class="hint">Letters, numbers or underscores Â· 3-20 characters</small>
          </div>

          <div class="field">
            <label for="bio">Bio</label>
            <textarea id="bio" rows="5" [(ngModel)]="bio"
              placeholder="Share tactics, mains or a friendly hello."></textarea>
            <small class="hint">Let others know more about you.</small>
          </div>

          <div class="field-actions">
            <app-button label="Save changes" size="small" (click)="saveIdentity()"></app-button>
          </div>
          <p class="inline-feedback" *ngIf="feedbackMessages.username">{{ feedbackMessages.username }}</p>
          <p class="inline-feedback" *ngIf="feedbackMessages.bio">{{ feedbackMessages.bio }}</p>
        </section>
      </div>

      <section class="preference-section">
        <div class="section-heading">
          <div>
            <h2>Languages</h2>
            <p>Let players know how they can best coordinate with you.</p>
          </div>
          <span class="selected-count">{{ selectedLanguages.length }} selected</span>
        </div>
        <div class="language-grid">
          @for (lang of languages; track lang.code) {
          <label class="language-chip">
            <input type="checkbox" class="visually-hidden" [id]="lang.code"
              [checked]="selectedLanguages.includes(lang.code)" (change)="toggleLanguage(lang.code)" />
            <span>{{ lang.name }}</span>
          </label>
          }

        </div>

        <div class="section-actions">
          <app-button label="Save languages" size="small" (click)="saveLanguages()"></app-button>
        </div>
        <p class="inline-feedback" *ngIf="feedbackMessages.languages">{{ feedbackMessages.languages }}</p>
      </section>

      <section class="preference-section">
        <div class="section-heading">
          <div>
            <h2>Playstyle &amp; platforms</h2>
            <p>Set expectations for matchmaking and co-op sessions.</p>
          </div>
        </div>

        <div class="preference-grid">
          <div class="field">
            <label for="playstyle">Playstyle</label>
            <div class="input-wrapper">
              <select id="playstyle" [(ngModel)]="playstyle">
                <option value="">Select playstyle</option>
                <option value="Competitive">Competitive</option>
                <option value="Casual">Casual</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label>Platforms</label>
            <div class="platform-grid">
              @for (platform of availablePlatforms; track platform) {
              <label class="platform-pill">
                <input type="checkbox" class="visually-hidden" [value]="platform"
                  [checked]="selectedPlatforms.includes(platform)" (change)="togglePlatform(platform)" />
                <span>{{ platform }}</span>
              </label>
              }

            </div>
          </div>
        </div>

        <div class="section-actions">
          <app-button label="Save preferences" size="small" (click)="savePlaystyleAndPlatform()"></app-button>
        </div>
        <p class="inline-feedback" *ngIf="feedbackMessages.playstyle">{{ feedbackMessages.playstyle }}</p>
      </section>
    </article>
  </div>
</section>
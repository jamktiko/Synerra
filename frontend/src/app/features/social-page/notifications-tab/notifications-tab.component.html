<div class="notificationsTab">

  <div class="noti-clear">
    @if (!messages?.length && !friendRequests?.length) {
    <h3>No notifications!</h3>
    }
  </div>


  <div class="tabsConts">

    <div class="conts">
      @if (messages?.length) {
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h3 class="noti-heading">Messages</h3>
        <div class="clear-button">
          <app-button label="Mark messages read" size="xsmall" variant="highlight" (click)="markAllAsRead()"
            aria-label="Mark all messages as read">
          </app-button>
        </div>
      </div>
      }


      @if (messages?.length) {
      <div class="tab-content">
        <div class="tab-pane">
          @for (msg of messages; track $index) {
          <div class="card mb-2 p-2 text-white">
            <div class="d-flex align-items-center w-100">
              <img [src]="msg.profilePicture || 'assets/images/profilePicPlaceHolder.jpg'" class="acount-icon"
                [alt]="msg.senderUsername + ' profile picture'" />

              <div class="userTextBar flex-grow">
                <strong>{{ msg.senderUsername }}</strong><br />
                <small>{{ msg.content }}</small><br />
                <small class="timestamp">{{ msg.timestamp | date:'short' }}</small>
              </div>

              <div class="friend-actions">
                <app-button label="Open" size="xsmall" variant="highlight" (click)="userClicked(msg.roomId)"
                  [attr.aria-label]="'Open chat with ' + msg.senderUsername">
                </app-button>
              </div>

            </div>
          </div>
          }
        </div>
      </div>
      }


      @if (friendRequests?.length) {
      <div>
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h3 class="noti-heading">Friend Requests</h3>
          <div class="clear-button">
            <app-button label="Clear all requests" size="xsmall" variant="highlight" (click)="markRequestsAsRead()"
              aria-label="Clear all requests">
            </app-button>
          </div>
        </div>

        @if (safeFriendRequests.length > 0) {
        <div class="tab-content">
          <div class="tab-pane">
            @for (n of friendRequests; track n.fromUserId) {
            <div class="card mb-2 p-2 text-white">
              <div class="d-flex align-items-center">

                <img [src]="n.senderPicture" class="acount-icon" [alt]="n.fromUsername + ' profile picture'" />

                <div class="userTextBar flex-grow">
                  <strong>{{ n.fromUsername }}</strong><br />

                  @if (n.status === 'PENDING') {
                  <small>Sent you a friend request</small>
                  }
                  @if (n.status === 'ACCEPTED') {
                  <small>accepted your friend request</small>
                  }
                  @if (n.status === 'DECLINED') {
                  <small>declined your friend request</small>
                  }
                </div>

                @if (n.status === 'PENDING') {
                <div class="actions">
                  <app-button label="Accept" size="xsmall" variant="highlight"
                    (click)="acceptRequest(n.fromUserId); clearRequest(n.fromUserId)"
                    [attr.aria-label]="'Accept friend request from ' + n.fromUsername">
                  </app-button>
                  <app-button label="Decline" size="xsmall"
                    (click)="declineRequest(n.fromUserId); clearRequest(n.fromUserId)"
                    [attr.aria-label]="'Decline friend request from ' + n.fromUsername">
                  </app-button>
                </div>
                }

                @if (n.status === 'ACCEPTED' || n.status === 'DECLINED') {
                <div class="friend-actions">
                  <app-button label="Clear" size="xsmall" variant="highlight" (click)="clearRequest(n.fromUserId)"
                    [attr.aria-label]="'Clear friend request notification for ' + n.fromUsername">
                  </app-button>
                </div>
                }

              </div>
            </div>
            }
          </div>
        </div>
        }
      </div>
      }

    </div>
  </div>